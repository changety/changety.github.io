
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Bian&#8217;s blog</title>
	<meta name="author" content="BianYuting">

	
	<meta name="description" content="android, fast-serializer, fastjson, java, kryo, 序列化 Comments Android序列化方案比较 前言 &emsp;&emsp;目前移动客户端应用程序上，需要将用户内容持久化到设备上，一般任何feed流应用，如微博、推特、 &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Bian's blog" type="application/atom+xml">
	
	<link rel="canonical" href="http://changety.github.io/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="	http://cdn.staticfile.org/jquery/1.7.2/jquery.min.js"></script>
	<link href="/stylesheets/google-fonts.css" rel="stylesheet" type="text/css">
	
</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		document.write("<img alt='Profile Picture' src='/images/avatar.png' style='width:160px;'/>");
	</script>
</div>
<h1><a href="/">Bian&#8217;s blog</a></h1>
<p class="subtitle">as a time machine</p>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Home</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/aboutme">About</a></li>
</ul>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		<a class="weibo" href="http://www.weibo.com/changety" title="Weibo">Weibo</a>
		
		
		
		
		
		<a class="github" href="https://github.com/changety" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
<p class="description">be the change you want to see in the world</p>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-19T00:34:58+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/android/'>android</a>, <a class='category' href='/blog/categories/fast-serializer/'>fast-serializer</a>, <a class='category' href='/blog/categories/fastjson/'>fastjson</a>, <a class='category' href='/blog/categories/java/'>java</a>, <a class='category' href='/blog/categories/kryo/'>kryo</a>, <a class='category' href='/blog/categories/xu-lie-hua/'>序列化</a>


</div>
		
			<span class="comments"><a href="/blog/2014/10/19/android-serialization-compare/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/19/android-serialization-compare/" itemprop="url">Android序列化方案比较</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1>前言</h1>

<p>&emsp;&emsp;目前移动客户端应用程序上，需要将用户内容持久化到设备上，一般任何feed流应用，如微博、推特、新闻客户端等都需要将内容做持久化操作，以便在内存回收后，再次进入程序能迅速恢复之前的内容。另外如一些视频、音乐、购物等软件，凡是收藏的视频、歌曲、商品以及个人主页等，也应将这些用户私有的内容做序列化，以便无网进入时也能看到相关内容，并正常使用软件。陆陆续续使用和测试过一些Java序列化方案，这篇主要从Android客户端应用程序的角度，并以速度、序列化文件大小、实践简易性为主要考虑指标介绍并对比以下序列化方案。</p>

<hr />

<h1>JVM-Serializsers</h1>

<p>&emsp;&emsp;首先介绍一下<a href="https://github.com/eishay/jvm-serializers">JVM-Serializsers</a>，是一个很不错的测试序列化的工具，可以用它来评测各种流行的java序列化反序列化工具，在其测试模型上构建新的序列化使用上也很方便。本文结合JVM-Serializsers测试模型，并在其测试模型下新增测试了<a href="https://code.google.com/p/fast-serialization/">fast-serialization</a>的测试。本文重点介绍Java原生序列化、<a href="https://github.com/EsotericSoftware/kryo">Kryo</a>、<a href="https://code.google.com/p/fast-serialization/">fast-serialization</a>、<a href="http://code.alibabatech.com/wiki/display/FastJSON/Home">fastjson</a>、<a href="https://code.google.com/p/protobuf/">protocol-buffers</a>等几种典型的序列化方案。</p>

<hr />

<p><a href="https://github.com/eishay/jvm-serializers">JVM-Serializsers</a>下载源码后，具体步骤如下：</p>

<h4>1.切到jvm-seruakuzaers源码tcp目录下：</h4>

<p><img src="/images/android_serializaion/swich_term.png"></p>

<h4>2.编译源码：</h4>

<p><img src="/images/android_serializaion/make_compile.png"></p>

<h4>3.运行测试案案例：</h4>

<p><img src="/images/android_serializaion/test_serilization.png"></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>./run -chart -include=kryo,fst-serialization,java-built-in,protobuf,hessian,json/google-gson/databind,
</span><span class='line'>xml/xstream+c,bson/mongodb,bson/jackson/databind,json/fastjson/databind,json/jackson/databind,thrift,avro-generic data/media.1.cks</span></code></pre></td></tr></table></div></figure>


<p>include参数代表要进行测试的序列化工具，当然前提是在jvm-serialization中的测试模型下已经构建完相应工具的测试用例。更多参数可通过./run -help看说明，如果带上-chart参数，还会生成序列化性能数据的图形对比。</p>

<hr />

<h3>测试环境：</h3>

<p>os：os x-10.9</p>

<p>jdk：java version &ldquo;1.7.0_51&rdquo;</p>

<p>mem：16G</p>

<p>cpu: 2.3 GHz Intel Core i7</p>

<hr />

<h3>运行结果：</h3>

<p><img src="/images/android_serializaion/test_serilization_result.png"></p>

<p>表中参数介绍：</p>

<p><code>Total Time (“total”)</code>：创建一个对象，将其序列化成一个字节数组，然后再反序列化成一个对象。</p>

<p><code>Serialization Time (“ser”)</code>：创建一个对象，将其序列化成一个字节数组。</p>

<p><code>Deserialization Time (“deser+deep”)</code>：相比于序列化，反序列化更耗时。为了更公平的比较，jvm-serializers在反序列化测试时访问了反序列化得到的对象的所有字段（也就是deep的含义），因为部分工具反序列化时“偷懒”而没有做足工作。</p>

<p><code>Serialized Size (“size”)</code>：序列化数据的大小，这个大小会依赖于使用的数据。</p>

<p><code>Serialization Compressed Size (“size+dfl”)</code>：使用java内置的DEFLATE(zlib)压缩的序列化数据的大小。</p>

<p><code>Object Creation Time (“create”)</code>：对象创建耗时很短（平均100纳秒）所以通常的比较没什么意义。不过，不同工具创建的对象在表现上会有不同。有的工具只是创建普通的java类，你可以直接访问其字段，而有的使用get/set方法，有的使用builder模式。</p>

<p>该工具还将这些数据通过google chart服务生成数据图形对比图：</p>

<p><img src="/images/android_serializaion/225646_yuk9_271796.png"></p>

<p>以上已经可以利用强大的JVM-Serializsers工具来分析跟构建自己想测试的序列化工具了，更多在Android Runtime的测试见下文。</p>

<hr />

<h1>Java序列化工具技术原理比较</h1>

<h2>Binary Formats &amp; language-specific ones：</h2>

<p>JavaBuiltIn（java原生）、JavaManual（根据成员变量类型，手工写）、<a href="https://code.google.com/p/fast-serialization/">FstSerliazation</a>、<a href="https://github.com/EsotericSoftware/kryo">Kryo</a></p>

<h2>Binary formats-generic language-unspecific ones：</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[Protobuf](https://code.google.com/p/protobuf/)、[Thrift](https://thrift.apache.org/)、 [AvroGeneric](https://avro.apache.org/docs/current/)、[Hessian](http://hessian.caucho.com/)</span></code></pre></td></tr></table></div></figure>


<h2>JSON Format：</h2>

<p><a href="http://jackson.codehaus.org/">Jackson</a>、<a href="https://code.google.com/p/google-gson/">Gson</a>、<a href="http://code.alibabatech.com/wiki/display/FastJSON/Home">FastJSON</a></p>

<h2>JSON-like：</h2>

<p>CKS  textual JSON-like format）、BSON（JSON-like format with extended datatypes）JacksonBson、<a href="http://docs.mongodb.org/meta-driver/latest/legacy/bson/">MongoDB</a></p>

<h2>XML-based formats：</h2>

<p><a href="http://xstream.codehaus.org/">XmlXStream</a></p>

<p>java的序列化工具大致就可以分为以上几类，简单概括就分为二进制binary和文本格式（json、xml）两大类。</p>

<p>从运行结果的图中可以较为明显的看出，在速度的对比上一般有如下规律：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>binary &gt; textual
</span><span class='line'>language-specific &gt; language-unspecific</span></code></pre></td></tr></table></div></figure>


<p>而textual中，由json相比xml冗余度更低因此速度上更胜一筹，而json又bson这类textual serialization技术上更成熟，框架的选择上更丰富和优秀。下面重点介绍下Kryo、fast-serialiation、fastjson、protocol-buffer</p>

<hr />

<h1>典型Java序列化工具分析</h1>

<h2>(1) Java原生序列化工具</h2>

<p>&emsp;&emsp;Java本身提供的序列化工具基本上能胜任大多数场景下的序列化任务，关于其序列化机制，<a href="http://blog.csdn.net/zhaozheng7758/article/details/7820018">这篇文章很细致的解释了</a>，值得一读。Java自带的序列化工具在序列化过程中需要不仅需要将对象的完整的class name记录下来，还需要把该类的定义也都记录下，包括所有其他引用的类，这会是一笔很大的开销，尤其是仅仅序列化单个对象的时候。正因为java序列化机制会把所有meta-data记录下来，因此当修改了类的所在的包名后，反序列化则会报错。Java自带序列化工具的性能问题总结如下：</p>

<ul>
<li><p>一个single object的序列化会递归地，连同所有成员变量（instsnce variables）一起序列化了，这种默认机制很容易造成不必要的序列化开销。</p></li>
<li><p>序列化和反序列化过程需要上面的这种机制去递归并用反射机制去寻找所有成员变量的信息，另外如果没定义自己serialVersionUID的话，那么对象及其他变量都必须自己产生一个。上述过程开销很大。</p></li>
<li><p>使用默认序列化机制，所有序列化类定义完整信息都会被记录下来，包括所有包名、父类信息、以及成员变量</p></li>
</ul>


<hr />

<h2>(2) 优化过的Java序列化工具</h2>

<p>&emsp;&emsp;<a href="https://github.com/EsotericSoftware/kryo">kryo</a></p>

<p>&emsp;&emsp;kryo根据上述Java原生序列化机制的一些问题，对了很多优化工作，而且提供了很多serializer，甚至封装了Unsafe类型的序列化方式，更多关于Unsafe类型的序列化方式，请参考这里，需要注意的是，jdk1.7以后，默认关闭unsafe的类（sun.misc.Unsafe）包。更多kryo介绍参考kryo的wiki，这里贴一下kryo的典型用法。其中CompatibeFieldSerializer就是默认提供的一系列serializer的一种，顾名思义就是一种成员变量上下兼容的序列化工具，支持该类对成员变量的增删。另外kryo更新比较活跃，问题修复很快。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="n">Kryo</span> <span class="n">myKryo</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Kryo</span><span class="o">();</span>
</span><span class='line'><span class="kd">static</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">myKryo</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="n">MusicInfo</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">new</span> <span class="n">CompatibleFieldSerializer</span><span class="o">&lt;</span><span class="n">MusicInfo</span><span class="o">&gt;(</span><span class="n">myKryo</span><span class="o">,</span> <span class="n">Media</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="mi">50</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">saveObjectByKryo</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">,</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Output</span> <span class="n">output</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">output</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Output</span><span class="o">(</span><span class="k">new</span> <span class="nf">FileOutputStream</span><span class="o">(</span><span class="n">fileName</span><span class="o">),</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">);</span>
</span><span class='line'>        <span class="n">myKryo</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">output</span><span class="o">,</span> <span class="n">o</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">output</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>         <span class="n">output</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">readObjectByKryo</span><span class="o">(</span><span class="n">String</span> <span class="n">filename</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Input</span> <span class="n">input</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Input</span><span class="o">(</span><span class="k">new</span> <span class="nf">FileInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">filename</span><span class="o">)));</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">myKryo</span><span class="o">.</span><span class="na">readObject</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="n">clazz</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">t</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">input</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">input</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<p>&emsp;&emsp;<a href="https://code.google.com/p/fast-serialization/">fast-serialization</a></p>

<p>&emsp;&emsp;fast-serialozation相对来说是一个很新的序列化工具，虽然从2-1的评测上来看，速度于kryo有一些差距，但根据本人在生产环境上的场景上测试，效果几乎于kryo一致，都能瞬间反序列化出内容并渲染，该序列化的原理描述：</p>

<blockquote><ul>
<li><p>Fast Serialization reimplements Java Serialization with focus on speed, size and compatibility. This allows the use of FST with minimal code change.</p></li>
<li><p>FSTStructs implements a struct emulation to avoid de-/encoding completely. Use case is high performance message oriented software. Other applications are data exchange with other languages, reduction of FullGC by &lsquo;flattening&rsquo; complex Objects, fast offheap, Control of data locality (CPU cache friendly) for high performance computational tasks, allocation free java programs.</p></li>
</ul>
</blockquote>

<p>这里贴一下fast-serialization的使用方法，如果原来系统使用的Java原生的序列化工具，替换成fast-serialization非常简单：只要把Java的ObjectOutputStream与ObjectInputStream替换成FSTObjectOutput和FSTObjectInput就行了：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">saveObjectByJava</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">,</span> <span class="n">String</span> <span class="n">filename</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">FSTObjectOutput</span> <span class="n">oos</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="n">ObjectOutputStream</span> <span class="n">oos</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">oos</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">FSTObjectOutput</span><span class="o">(</span><span class="k">new</span> <span class="nf">FileOutputStream</span><span class="o">(</span><span class="n">filename</span><span class="o">));</span>
</span><span class='line'>        <span class="n">oos</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
</span><span class='line'>        <span class="n">oos</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">oos</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">oos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">readObjectByJava</span><span class="o">(</span><span class="n">String</span> <span class="n">filename</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">FSTObjectInput</span> <span class="n">ois</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="n">ObjectInputStream</span> <span class="n">ois</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ObjectInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nf">FileInputStream</span><span class="o">(</span><span class="n">filename</span><span class="o">));</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">ois</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">t</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">ois</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">ois</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h2>（3）JSON</h2>

<p>&emsp;&emsp;从上一节的多种序列化工作的表现来看，比较优秀的JSON解析工具的表现还是比较好的，有些json解析工具甚至速度超过了一些二进制的序列化方式。Android环境下也有评测json解析性能的<a href="https://github.com/martinadamek/json-android-compare/wiki">demo</a>，下图可以看出jackson在速度上还是比较有优势的，但与Android自带的json包，也没有数量级以上的优势，而jackson的jar包大小达1mb多，因此对于普通的android应用来说是比较奢侈的。</p>

<p><img src="/images/android_serializaion/230423_zCZn_271796.png"></p>

<h2>4）Protocol-Buffer</h2>

<p>&emsp;&emsp;Protocol buffers是一个用来序列化结构化数据的技术，支持多种语言诸如C++、Java以及Python语言，可以使用该技术来持久化数据或者序列化成网络传输的数据。相比较一些其他的XML技术而言，该技术的一个明显特点就是更加节省空间（以二进制流存储）、速度更快以及更加灵活。 通常，编写一个protocol buffers应用需要经历如下三步：</p>

<p>1、定义消息格式文件，最好以proto作为后缀名</p>

<p>2、使用Google提供的protocol buffers编译器来生成代码文件，一般为.h和.cc文件，主要是对消息格式以特定的语言方式描述</p>

<p>3、使用protocol buffers库提供的API来编写应用程序</p>

<p>具体方法可参考google Protobuf 提供的详细的<a href="https://developers.google.com/protocol-buffers/docs/overview">developer guide</a></p>

<hr />

<h1>总结</h1>

<ul>
<li><p>就已有原先使用Java原生序列化方案的系统来说，kryo于fst-serializer是良好的java原生序列化方案替代者，不仅体现再编程简单，而且速度与性能上会有大幅提升，尤其是fst-serializer ，只需替代output/inputstream 即可，性能的提升上也很可观，目前该工具刚出来，稳定性还需要多测测。</p></li>
<li><p>如果程序本身就用json格式序列化，则可以考虑引入一个性能优异的json解析库，一般再服务端jackson是广受欢迎的解析库，但是其1.1mb的jar包大小对一般的Android应用有点奢侈，而fastjson在Android上的表现似乎没有再JDK上那么好，不过也比大多数解析库快了。另外用textual格式序列化对象，在Android客户端上还要考虑一些安全问题。</p></li>
<li><p>protobuffer更多的是一种取代xml的夸语言的消息交换格式，尽快速度很快，但是编程上需要定义消息格式，对成员变量多、业务复杂的javabean来说代价是较为复杂的，对稳定的已有系统来说总体代价较高。</p></li>
</ul>


<p>下表是几种方案的各项指标的一个对比 ：</p>

<table>
<thead>
<tr>
<th>序列化工具      </th>
<th> 序列化速度 </th>
<th> 序列化文件大小 </th>
<th> 编程模型复杂度  </th>
<th> 社区活跃度  </th>
<th> jar包大小 </th>
</tr>
</thead>
<tbody>
<tr>
<td>kryo           </td>
<td> 极快      </td>
<td> 小            </td>
<td> 简单          </td>
<td>     高       </td>
<td> 132kb  </td>
</tr>
<tr>
<td>fst-serializer </td>
<td> 快        </td>
<td> 小            </td>
<td> 非常简单      </td>
<td>     高       </td>
<td> 246kb  </td>
</tr>
<tr>
<td>protobuffer    </td>
<td> 快        </td>
<td> 较大          </td>
<td> 复杂          </td>
<td>     稳定      </td>
<td> 329kb  </td>
</tr>
<tr>
<td>fastjson       </td>
<td> 较快      </td>
<td> 较大          </td>
<td> 简单          </td>
<td>     稳定       </td>
<td> 338kb  </td>
</tr>
<tr>
<td>jackson        </td>
<td> 一般      </td>
<td> 较大          </td>
<td> 简单          </td>
<td>     稳定       </td>
<td> 1.1mb  </td>
</tr>
<tr>
<td>gson           </td>
<td> 较慢      </td>
<td> 较大          </td>
<td> 简单          </td>
<td>     稳定       </td>
<td> 189kb  </td>
</tr>
</tbody>
</table>


<hr />

<h1>参考资料</h1>

<p>Java序列化机制介绍及简单优化方法： <a href="http://www.javacodegeeks.com/2010/07/java-best-practices-high-performance.html">http://www.javacodegeeks.com/2010/07/java-best-practices-high-performance.html</a></p>

<p>Java序列化“最佳”实践： <a href="http://www.javacodegeeks.com/2010/07/java-best-practices-high-performance.html">http://www.javacodegeeks.com/2010/07/java-best-practices-high-performance.html</a></p>

<p>提升Java序列化的几种方法： <a href="http://www.javacodegeeks.com/2013/09/speed-up-with-fast-java-and-file-serialization.html">http://www.javacodegeeks.com/2013/09/speed-up-with-fast-java-and-file-serialization.html</a></p>

<p>详细的Java序列化过程： <a href="http://blog.csdn.net/zhaozheng7758/article/details/7820018">http://blog.csdn.net/zhaozheng7758/article/details/7820018</a></p>

<p>Unsafe类型的Java序列化方法： <a href="http://www.javacodegeeks.com/2012/07/native-cc-like-performance-for-java.html">http://www.javacodegeeks.com/2012/07/native-cc-like-performance-for-java.html</a></p>

<p>protobuf介绍1：<a href="http://www.ibm.com/developerworks/cn/linux/l-cn-gpb/">http://www.ibm.com/developerworks/cn/linux/l-cn-gpb/</a></p>

<p>protobuf介绍2： <a href="http://www.cnblogs.com/royenhome/archive/2010/10/29/1864860.html">http://www.cnblogs.com/royenhome/archive/2010/10/29/1864860.html</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-15T00:11:52+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/octopress/'>octopress</a>


</div>
		
			<span class="comments"><a href="/blog/2014/10/15/one-octopress-blog-on-mutil-place/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/15/one-octopress-blog-on-mutil-place/" itemprop="url">Octopress Blog由多台设备维护</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1>前言</h1>

<p><a href="http://changety.github.io/blog/2014/10/12/setup-octopress-github-blog/">之前这篇</a>介绍了如何在mac下部署octopress，<a href="http://changety.github.io/blog/2014/10/13/muti-octopress-blog-on-one-pc:mac/">这篇</a>还介绍了一台mac上维护同时维护多个octopress的方法，本篇再介绍一下如何再多台设备上，同时维护一个octopress blog上的方法。</p>

<hr />

<h1>octopress blog的repo分支说明</h1>

<p>一个octopress blog的repo由source、master两个分支组成。</p>

<p>source分支位于 <code>cd ~/octopress</code> 中</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd ~/octopress
</span><span class='line'>git branch # *source</span></code></pre></td></tr></table></div></figure>


<p>这个分支用于存放markdown源文件，theme，plugin等用于生成blog所需要的所有文件的，因此之前我们写博客的时候，提交的内容，一般都到在source上：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git push origin source #即将本地内容push到远端git repo 的source分支上。</span></code></pre></td></tr></table></div></figure>


<p>master分支位于 <code>cd ~/octopress/_deploy</code>中，这个分支用于存放blog站点本身</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd ~/octopress/_deploy
</span><span class='line'>git branch # *master</span></code></pre></td></tr></table></div></figure>


<hr />

<h1>在新的设备上部署已有的octopress</h1>

<p>首先像构建全新octopress 一样， 准备好octopress的部署环境</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git --version</span></code></pre></td></tr></table></div></figure>


<p>git的版本号对安装octopress影响不大，这里不用关心，只要有git工具就可以了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ruby --version #shold be 1.9.3#p125 or other version can be set up an octopress</span></code></pre></td></tr></table></div></figure>


<p>配置环境的方法参考<a href="http://changety.github.io/blog/2014/10/12/setup-octopress-github-blog/">这里</a></p>

<p>理解octopress blog的工作原理以及分支组成后，新的设备复制已有的octopress blog 只要把source/master clone到本地，并安装完成类似构建新octopress blog一样的配置及工具即可。以下是具体步骤：</p>

<h3>将source分支 clone到 octopress目录下</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone -b source git@github.com:username/username.github.com.git octopress 
</span></code></pre></td></tr></table></div></figure>


<h3>将master分支 clone到 octopress/_deploy目录下</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd octopress #进入到octopress目录下，看看_deploy是否存在，存在的话且不为空，先清空
</span><span class='line'>$ git clone git@github.com:username/username.github.com.git _deploy  #clone master分支</span></code></pre></td></tr></table></div></figure>


<h3>安装配置工作</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ gem install bundler
</span><span class='line'>$ rbenv rehash
</span><span class='line'>$ bundle install</span></code></pre></td></tr></table></div></figure>


<p>注意：由于远端的blog可能已经配置主题、所以省去安装默认主题的这一步： <code>rake install</code></p>

<h3>关联blog</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake setup_github_pages</span></code></pre></td></tr></table></div></figure>


<p>提示你输入关联的repo的 git url</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Enter the read/write url for your repository
</span></code></pre></td></tr></table></div></figure>


<p>输入需要关联的repo的git url即可， 比如 git@github.com:username/username.github.com</p>

<p>关联完成后，检查一下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git remote -v
</span><span class='line'>
</span><span class='line'>octopress git://github.com/imathis/octopress.git (fetch)
</span><span class='line'>octopress git://github.com/imathis/octopress.git (push)
</span><span class='line'>origin    https://github.com/username/username.github.io (fetch)  #关联blog 的远程 repo
</span><span class='line'>origin    https://github.com/username/username.github.io (push)</span></code></pre></td></tr></table></div></figure>


<p>至此，如果没有错误的话，本地已经完成了一个已有octopress blog复制跟关联。</p>

<h1>在两台设备上写blog</h1>

<p>接下来其实就与git 上共同开发项目一样，首先需要pull下来最新的远端repo的内容，本地做出修改后，也要将内容push到远端。每次同步与提交，都要把source/master两个分支的同步。</p>

<p>比如新部署完成的 <code>A电脑</code>上写一篇文章：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake new_post['new post on new computer']
</span><span class='line'>
</span><span class='line'>git add .
</span><span class='line'>git commit -m 'create a new post in new compter'
</span><span class='line'>git push origin source #push source内容到repo上
</span><span class='line'>
</span><span class='line'>rake deploy 发布blog</span></code></pre></td></tr></table></div></figure>


<p>切到另一台<code>B电脑</code>上：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd octopress
</span><span class='line'>git pull origin source  # 同步source分支
</span><span class='line'>cd octopress/_deploy
</span><span class='line'>git pull origin master  # 同步master分支， 因为之前rake dedploy会修改master的内容
</span></code></pre></td></tr></table></div></figure>


<p>此后，在这台<code>B电脑</code>上修改并且 <code>rake deploy</code>后，在<code>A电脑</code>上也需要先pull 完两个分支的内容。</p>

<h3>总结:</h3>

<h4>1.pull source 分支、pull master分支</h4>

<h4>2.写文章、改主题&hellip;&hellip; (git commit)</h4>

<h4>3.git push origin source</h4>

<h4>4.rake deploy（相当于push到远端master分支）</h4>

<hr />

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-13T22:03:06+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/octopress/'>octopress</a>


</div>
		
			<span class="comments"><a href="/blog/2014/10/13/muti-octopress-blog-on-one-pc:mac/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/13/muti-octopress-blog-on-one-pc:mac/" itemprop="url">一台mac维护多个octopress Blog</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1>前言</h1>

<h2><a href="http://changety.github.io/blog/2014/10/12/setup-octopress-github-blog/">上篇</a>介绍了如何在mac下部署octopress，可能少有人会跟我一样折腾，还打算在一台mac上维护两个octopress blog，这里介绍一下具体办法，一言以蔽之就是在其他目录下再创建一个octopress，以后在此目录下维护第二个blog，以下是具体流程。</h2>

<h1>创建第二个octopress blog的repo</h1>

<h2>github不支持同一个账户创建多个github page的repo， 因此再去申请另一个github帐号就可以了，然后依然是首先到<a href="https://github.com/new">github</a>创建一个<code>anotherUsername.github.io</code>的repo，<code>anotherUsername.github.io</code>以后就是第二个blog的域名</h2>

<h1>准备安装Octopress所需的环境</h1>

<p>由于有了第一个octopress blog的安装基础， 因此默认认为mac上已经有了octopress的环境：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git --version</span></code></pre></td></tr></table></div></figure>


<p>git的版本号对安装octopress影响不大，这里不用关心，只要有git工具就可以了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ruby --version #此时应该已是1.9.3p125 (2012-02-16 revision 34643)，或者其他你成功安装了octopress的ruby版本</span></code></pre></td></tr></table></div></figure>


<h1>安装第二个Octopress</h1>

<p>一般第一个octopress一般都装在 <code>cd ~/octopress</code> 下，这里假设把第二个octopress安装在 <code>~/anotherBlog/octopress</code>下</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd ~
</span><span class='line'>$ mkdir anotherBlog #作为第二个octopress所在目录
</span><span class='line'>$ cd anotherBlog
</span><span class='line'>$ git clone git://github.com/imathis/octopress.git octopress </span></code></pre></td></tr></table></div></figure>


<h3>同样安装完依赖跟默认主题</h3>

<p>首先查看一下<code>~/anotherBlog/octopress</code>下的ruby版本：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ruby --version #如果跟第一个octopress所在目录下version版本一致即可，不一样的话，参考第一篇中介绍rbenv 环境变量的设置</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ gem install bundler
</span><span class='line'>$ rbenv rehash
</span><span class='line'>$ bundle install
</span><span class='line'>
</span><span class='line'>$ rake install #默认主题
</span></code></pre></td></tr></table></div></figure>


<hr />

<p>运行以下命令，仔细看提示完成github和Octopress的关联（就是第一步创建的第二个博客的repo <a href="https://github.com/anotherUsername/anotherUsername.github.io">https://github.com/anotherUsername/anotherUsername.github.io</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake setup_github_pages</span></code></pre></td></tr></table></div></figure>


<p>关联成功后可以看下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git remote -v #关联的远程repo信息
</span></code></pre></td></tr></table></div></figure>


<p>正确关联的话就会如下显示：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>octopress    git://github.com/imathis/octopress.git (fetch)
</span><span class='line'>octopress git://github.com/imathis/octopress.git (push)
</span><span class='line'>origin    https://github.com/anotherUsername/anotherUsername.github.io (fetch)
</span><span class='line'>origin    https://github.com/anotherUsername/anotherUsername.github.io (push)</span></code></pre></td></tr></table></div></figure>


<h3>接下来生成blog</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake generate
</span><span class='line'>
</span><span class='line'>$ rake preview #http://localhost:4000# ，preview一下另一个blog</span></code></pre></td></tr></table></div></figure>


<p>打开<a href="http://localhost:4000">http://localhost:4000/</a>，就能看到第二个octopress blog也建起来了。</p>

<h2>至此第二个octopress blog 就搭建完了，就可以在一台mac下同时维护多个blog了，之后写blog、装插件、换配置就都一样了。够折腾吧- -!</h2>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-12T03:00:00+08:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/octopress/'>octopress</a>


</div>
		
			<span class="comments"><a href="/blog/2014/10/12/setup-octopress-github-blog/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/12/setup-octopress-github-blog/" itemprop="url">使用github Page与octopress搭建个人blog</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h1>前言</h1>

<p>前段时间云音乐Android小组打算自己搭建一个blog，用于总结跟记录工作中遇到的技术问题。之前自己在其他地方记录过几篇blog，也一直想搭个blog的玩玩，借此机会正好操练。
出于对Github极大的好感，自然就想到利用Github Page服务搭建一个blog，网络上已经存在大量关于利用Github与Octopress搭建blog的文章，但是质量参次不齐，实际我在搭建的过程中就遇到了不少问题，这里记录一下其他文章中忽略的一些细节，梳理一下流程，同时帮碰到相同问题的同学节省时间。可能少有人会跟我一样折腾，还打算在一台mac上维护两个octopress blog、其中一个octopress blog 还需要在多台设备上一起更新（android 小组），因此这篇blog先介绍创建一个常规octopress blog的步骤，之后再介绍下一台电脑上维护两个octopress blog 以及 一个octopress blog 在多个地方(电脑)上更新的方法。</p>

<hr />

<h1>配置github信息</h1>

<p>默认你已经创建了github帐号，如果还没有，先到<a href="https://github.com/">github</a>上注册一个，记得起一个酷炫或者有特殊意义的<code>username</code>，这会是个稍候blog域名的prefix。并且默认你已经完成本机上完成github帐号信息的配置，如果还没有，请查看<a href="https://help.github.com/articles/set-up-git/">github help</a></p>

<hr />

<h1>节省漫长的十多分钟等待时间</h1>

<p>首先到<a href="https://github.com/new">github</a>创建一个<code>username.github.io</code>的repo，<code>username.github.io</code>以后就是blog的域名（当然他支持使用自定义的域名）， username就是你在github上的username。之所以先完成这一步，是因为github一般需要10分钟左右来同步缓存数据，一般创建完repo后，直接访问，浏览器会告诉你这个：</p>

<p><img src="/images/why_this_first.png"></p>

<hr />

<h1>准备安装Octopress所需的环境</h1>

<p><a href="http://octopress.org/docs/setup/">这里</a>是Octopress的官方指南，里面很精简的描述了安装步骤，我这里再啰嗦一次（主要是想讲坑</p>

<p>安装octopress时，首先需要git跟ruby环境，这两样工具，一般mac都已经自带了，可以在terminal里分别</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git --version</span></code></pre></td></tr></table></div></figure>


<p>git的版本号对安装octopress影响不大，这里不用关心，只要有git工具就可以了。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ruby --version</span></code></pre></td></tr></table></div></figure>


<p>如果打印出来的ruby版本信息是1.9.3，那接下来的安装会省却不少麻烦。ruby的向下兼容不好，因此基于Ruby所做的框架大多要求特定版本，octpress也是，<a href="http://octopress.org/docs/setup/">这里</a>就提到需要ruby 1.9.3这个版本，我当时想试试mac自带的2.1.1这个ruby版本上的安装，结果是一坑接一坑，会缺各种各样依赖，所以不想折腾的朋友老实安装1.9.3这个版本好了。ruby多版本管理可以用RVM和rbenv。在mac下，推荐使用<a href="http://brew.sh/">Homebrew</a>来安装rbenv（ruby社区普通推荐rbenv），如果你没有Homebrew，打开终端，先安装完Homebrew，根据终端一步一步安装完就好，基本不会遇到什么问题。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"</span></code></pre></td></tr></table></div></figure>


<p>有了Homebrew就可以安装rbenv了</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew update 
</span><span class='line'>$ brew install rbenv
</span><span class='line'>$ brew install ruby-build</span></code></pre></td></tr></table></div></figure>


<p>使用rbenv安装1.9.3版本的ruby，ruby1.9.3下还有多次发行版，稳妥期间，推荐直接安装1.9.3-p125，参考过其他blog的经验</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rbenv install 1.9.3-p125
</span><span class='line'>$ rbenv local 1.9.3-p125 #Sets a local application-specific Ruby version
</span><span class='line'>$ rbenv rehash
</span><span class='line'>$ ruby --version #ruby 1.9.3p125 (2012-02-16 revision 34643) [x86_64-darwin13.1.0]</span></code></pre></td></tr></table></div></figure>


<hr />

<p>安装完成后可以用ruby &ndash;version进行验证，那么问题就来了，虽然上面敲了rbenv local设置在当前的ruby版本环境，终端很有可能显示的还是mac自带的版本，原因是因为还没有在</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd ~/.bash_profile</span></code></pre></td></tr></table></div></figure>


<p>配置rbenv的环境变量，具体步骤如下： （更详尽的配置说明参考<a href="https://github.com/sstephenson/rbenv">这里</a></p>

<p>Add ~/.rbenv/bin to your $PATH for access to the rbenv command-line utility.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ echo 'export PATH="$HOME/.rbenv/bin:$PATH"' &gt;&gt; ~/.bash_profile</span></code></pre></td></tr></table></div></figure>


<p>Ubuntu Desktop note: Modify your ~/.bashrc instead of ~/.bash_profile.
Zsh note: Modify your ~/.zshrc file instead of ~/.bash_profile.</p>

<p>Add rbenv init to your shell to enable shims and autocompletion.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ echo 'eval "$(rbenv init -)"' &gt;&gt; ~/.bash_profile</span></code></pre></td></tr></table></div></figure>


<p>Same as in previous step, use ~/.bashrc on Ubuntu, or ~/.zshrc for Zsh.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ source ~/.bash_profile</span></code></pre></td></tr></table></div></figure>


<p>然后再切到~/octopress下，</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ruby --version #此时应该已是1.9.3p125 (2012-02-16 revision 34643)</span></code></pre></td></tr></table></div></figure>


<hr />

<h1>安装Octopress</h1>

<p>准备完毕octopress所需的环境后，就可以按照官方指南安装Octpress了</p>

<h3>clone octopress</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone git://github.com/imathis/octopress.git octopress</span></code></pre></td></tr></table></div></figure>


<h3>安装依赖</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd octopress
</span><span class='line'>$ gem install bundler
</span><span class='line'>$ rbenv rehash
</span><span class='line'>$ bundle install</span></code></pre></td></tr></table></div></figure>


<h3>安装octopress默认主题</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake install</span></code></pre></td></tr></table></div></figure>


<p>接下去会专门写一篇关于octopress主题的blog</p>

<hr />

<p>运行以下命令，仔细看提示完成github和Octopress的关联（就是第一步创建的这个repo <a href="https://github.com/username/username.github.io">https://github.com/username/username.github.io</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake setup_github_pages</span></code></pre></td></tr></table></div></figure>


<hr />

<h1>创建博客</h1>

<h3>生成博客</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake generate </span></code></pre></td></tr></table></div></figure>


<h3>上传代码</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git add .
</span><span class='line'>$ git commit -m 'create first blog'
</span><span class='line'>$ git push origin source</span></code></pre></td></tr></table></div></figure>


<h3>部署博客</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake deploy</span></code></pre></td></tr></table></div></figure>


<p>这里<code>origin</code>代表与octopress关联的repo
此时如果顺利完成后就能直接访问<code>http://username.github.io</code>看到自己的博客了， 由于首先创建了repo，就不需要等待10分钟了。</p>

<h3>修改配置</h3>

<p>配置文件路径为<code>~/octopress/_config.yml</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>url:                # For rewriting urls for RSS, etc
</span><span class='line'>title:              # Used in the header and title tags
</span><span class='line'>subtitle:           # A description used in the header
</span><span class='line'>author:             # Your name, for RSS, Copyright, Metadata
</span><span class='line'>simple_search:      # Search engine for simple site search
</span><span class='line'>description:        # A default meta description for your site
</span><span class='line'>date_format:        # Format dates using Ruby's date strftime syntax
</span><span class='line'>subscribe_rss:      # Url for your blog's feed, defauts to /atom.xml
</span><span class='line'>subscribe_email:    # Url to subscribe by email (service required)
</span><span class='line'>category_feeds:     # Enable per category RSS feeds (defaults to false in 2.1)
</span><span class='line'>email:              # Email address for the RSS feed if you want it.</span></code></pre></td></tr></table></div></figure>


<p>编辑完成后</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake generate
</span><span class='line'>
</span><span class='line'>$ git add .
</span><span class='line'>$ git commit -m "settings" 
</span><span class='line'>$ git push origin source
</span><span class='line'>
</span><span class='line'>$ rake deploy</span></code></pre></td></tr></table></div></figure>


<hr />

<h1>写博客</h1>

<p>到此为此博客已经成功搭建，赶紧测试一篇<code>hello world</code>的blog压压惊</p>

<h3>创建博文</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake new_post['hello world']</span></code></pre></td></tr></table></div></figure>


<p>生成的blog文件在<code>~/octopress/source/_posts</code>目录下，接下来可以用你所熟悉的markdown工具写博客了。</p>

<h3>使用markdown写博文</h3>

<p>如果一开始对markdown的语法不熟悉，这里推荐一个<a href="http://dillinger.io/">在线学习markdown语法的网站</a>)，所见即所得；或者可以直接其他blog上的用markdown写的文章，fork下来，参考样式与语法的比对，这样上手还是很快的。
写完后使用以下指令，并在浏览中输入<code>localhost:4000</code>, 查看blog的效果</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake preview #localhost:4000</span></code></pre></td></tr></table></div></figure>


<p>调试完后，生成blog并部署到github page上</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ rake generate
</span><span class='line'>
</span><span class='line'>$ git add .
</span><span class='line'>$ git commit -m "comment" 
</span><span class='line'>$ git push origin source
</span><span class='line'>
</span><span class='line'>$ rake deploy</span></code></pre></td></tr></table></div></figure>


<p>以上便是创建一个octopress blog的全部过程了，下一篇会继续说明如果在一台电脑上管理多个octpress blog 以及 一个octopress在多台电脑上共同维护的方法。</p>

<hr />

<h1>参考资料</h1>

<ul>
<li><a href="http://octopress.org/">http://octopress.org/</a></li>
<li><a href="http://msching.github.io/blog/2014/04/11/starting/">http://msching.github.io/blog/2014/04/11/starting/</a></li>
<li><a href="http://stackoverflow.com/questions/10940736/rbenv-not-changing-ruby-version">http://stackoverflow.com/questions/10940736/rbenv-not-changing-ruby-version</a></li>
</ul>


		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2014

    BianYuting


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'ibiandev';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





		</div>
	</div>
</body>
</html>
